<h1 class="title"><%= @shop.name %></h1>
<div class=row>
  <div class="col-md-5 shop-picture">
    <img src=<%= @shop.img.url %> class="cards-image">
  </div>
  <div class="col-md-7 shop-detail">
    <div class="row">
      <div class="col-md-6 shop-about">
        <h2 class="title show">About</h2>
        <div class="shop-star">
          <div class="row">
            <div class="star">
              <div class="average-review-rating" data-score=<%= @shop_comments.average(:rate) %>>
              </div>
              <%= render "/layouts/average" %>
            </div>
            <span class="small"><%= @shop.shop_comments.count %> 件の評価</span>
          </div>
        </div>
        <div class="shop-element">
          <div class="row">
            <p class="shop-tag">住所</p>
            <div class="shop-address"><%= @shop.prefecture %><%= @shop.address %></div>
          </div>
        </div>
        <div class="shop-element">
          <div class="row">
            <p class="shop-tag">電話番号</p>
            <% if @shop.TEL? %>
              <div class="shop-TEL"><%= @shop.TEL %></div>
            <% end%>
          </div>
        </div>
        <div class="shop-element">
          <div class="row">
            <p class="shop-tag">URL</p>
            <% if @shop.URL? %>
              <div class="shop-URL"><%= @shop.URL %></div>
            <% end%>
          </div>
        </div>
        <div class="shop-element">
          <div class="row">
            <p class="shop-tag">取扱豆</p>
          </div>
          <% @beans.each do |bean| %>
            <div class="row">
              <li>
                <%= bean.name %>
              </li>
            </div>
          <% end %>
        </div>
      </div>
      <div class="col-md-6 shop-comments">
        <h2 class="title show">Comments</h2>
        <% @shop_comments.each do |c| %>
          <div>
            <a href="/users/<%= c.user.id %>"><%= c.user.name %></a>
            <%= c.content %>
            <p>評価：<%= c.rate %>点</p>
            <div id="star-rate<%= c.id %>"></div>
            <script>
              $('#star-rate<%= c.id%>').empty();
                $('#star-rate<%= c.id%>').raty({
                  size      : 36,
                  starOff   : '<%= asset_path('star-off.png') %>',
                  starOn    : '<%= asset_path('star-on.png') %>',
                  half      : false,
                  readOnly: true,
                  score: <%= c.rate %>,
                });
            </script>
            <% if current_user && current_user.id == c.user_id %>
              <%= link_to "削除", shop_shop_comment_path(@shop, c), method: :delete, data: { confirm: "削除しますか？" } %>
            <% end %>
            <hr>
          </div>
        <% end %>
        <%= form_for [@shop, @shop_comment] do |f| %>
          <div class="form-group">
            <%= f.label :content, "内容"%>
            <%= f.text_field :content %>
          </div>
          <div class="form-group" id="star">
            <%= f.label :rate, "評価" %>
            <%= f.hidden_field :rate, id: :review_star %>
          </div>
          <%= f.hidden_field :shop_id, value: @shop.id %>
          <br>
          <%= f.submit "コメントする", class: "btn btn-success" %>
          <script>
            $('#star').empty();
              $('#star').raty({
                size     : 36,
                starOff:  '<%= asset_path('star-off.png') %>',
                starOn : '<%= asset_path('star-on.png') %>',
            
                scoreName: 'shop_comment[rate]',
                half: false,
              });
          </script>
        <% end %>
      </div>
    </div>
  </div>
</div>
