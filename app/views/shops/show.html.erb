<div class="container">
  <h1 class="form-title">店舗詳細</h1>
  <div class=row>
    <div class="col-md6 col-md-offset-3 form-wrapper">
      <p>【店舗名】<%= @shop.name %></p>
      <p>【平均評価】</p>
      <div class="average-review-rating" data-score=<%= @shop_comments.average(:rate) %>></div>
      <%= render "/layouts/average" %>
      <span><%= @shop.shop_comments.count %> 件の評価</span>
      <p>【取扱豆】</p>
      <% @beans.each do |bean| %>
        <div class="row">
          <%= bean.name %>
        </div>
        <p>
          <%= link_to "詳細", bean%>
          <% if current_user && current_user.id == bean.user_id %>
            <%= link_to "編集", edit_bean_path(bean) %>
            <%= link_to "削除", bean_path(bean), method: :delete, data: { confirm: "削除しますか？" } %>
          <% end %>
        </p>
      <% end %>
      <h2>コメント一覧</h2>
      <% @shop_comments.each do |c| %>
        <div>
          <a href="/users/<%= c.user.id %>"><%= c.user.name %></a>
          <%= c.content %>
          <p>評価：<%= c.rate %>点</p>
          <div id="star-rate<%= c.id %>"></div>
          <script>
            $('#star-rate<%= c.id%>').empty();
              $('#star-rate<%= c.id%>').raty({
                size      : 36,
                starOff   : '<%= asset_path('star-off.png') %>',
                starOn    : '<%= asset_path('star-on.png') %>',
                half      : false,
                readOnly: true,
                score: <%= c.rate %>,
              });
          </script>
          <% if current_user && current_user.id == c.user_id %>
            <%= link_to "編集", edit_shop_shop_comment_path(c) %>
            <%= link_to "削除", shop_shop_comment_path(@shop, c), method: :delete, data: { confirm: "削除しますか？" } %>
          <% end %>
          <hr>
        </div>
      <% end %>
      <%= form_for [@shop, @shop_comment] do |f| %>
        <div class="form-group">
          <%= f.label :content, "内容"%>
          <%= f.text_field :content %>
        </div>
        <div class="form-group" id="star">
          <%= f.label :rate, "評価" %>
          <%= f.hidden_field :rate, id: :review_star %>
        </div>
        <%= f.hidden_field :shop_id, value: @shop.id %>
        <br>
        <%= f.submit "コメントする", class: "btn btn-success" %>
        <script>
          $('#star').empty();
            $('#star').raty({
              size     : 36,
              starOff:  '<%= asset_path('star-off.png') %>',
              starOn : '<%= asset_path('star-on.png') %>',
          
              scoreName: 'shop_comment[rate]',
              half: false,
            });
        </script>
      <% end %>
    </div>
  </div>
</div>
